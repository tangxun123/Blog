(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{361:function(a,s,t){"use strict";t.r(s);var e=t(42),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"react-native-android-打包apk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#react-native-android-打包apk"}},[a._v("#")]),a._v(" React Native Android 打包APK")]),a._v(" "),t("h4",{attrs:{id:"生产签名密匙"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生产签名密匙"}},[a._v("#")]),a._v(" 生产签名密匙")]),a._v(" "),t("blockquote",[t("p",[a._v("你可以用keytool命令生成一个私有密钥。 也可以终端执行。")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("keytool "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("genkeypair "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("keystore my"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("release"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("keystore "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("alias my"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("key"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("alias "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("keyalg "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("RSA")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("keysize "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("validity "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10000")]),a._v("\n")])])]),t("p",[a._v("这条命令会要求你输入密钥库"),t("code",[a._v("（keystore）")]),a._v("和对应密钥的密码，然后设置一些发行相关的信息。最后它会在"),t("code",[a._v("android/app")]),a._v("目录下生成一个叫做"),t("code",[a._v("my-release-key.keystore")]),a._v("的密钥库文件。")]),a._v(" "),t("p",[a._v("在运行上面这条语句之后，密钥库里应该已经生成了一个单独的密钥，有效期为 10000 天。--alias 参数后面的别名是你将来为应用签名时所需要用到的，所以记得记录这个别名。")]),a._v(" "),t("h4",{attrs:{id:"设置-gradle-变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置-gradle-变量"}},[a._v("#")]),a._v(" 设置 gradle 变量")]),a._v(" "),t("ol",[t("li",[a._v("把"),t("code",[a._v("my-release-key.keystore")]),a._v("文件放到你工程中的"),t("code",[a._v("android/app")]),a._v("文件夹下（默认）。")]),a._v(" "),t("li",[a._v("编辑"),t("code",[a._v("~/.gradle/gradle.properties")]),a._v("（全局配置，对所有项目有效）或是项目目录/android/gradle.properties（项目配置，只对所在项目有效）。如果没有"),t("code",[a._v("gradle.properties")]),a._v("文件你就自己创建一个，添加如下的代码（注意把其中的****替换为相应密匙的密码）")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYAPP_RELEASE_STORE_FILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("my"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("release"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("keystore\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYAPP_RELEASE_KEY_ALIAS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("my"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("key"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("alias\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYAPP_RELEASE_STORE_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("**")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("**")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYAPP_RELEASE_KEY_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("**")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("**")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\n")])])]),t("h4",{attrs:{id:"把签名配置加入到项目的-gradle-配置中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#把签名配置加入到项目的-gradle-配置中"}},[a._v("#")]),a._v(" 把签名配置加入到项目的 gradle 配置中")]),a._v(" "),t("blockquote",[t("p",[a._v("编辑你项目目录下的 "),t("code",[a._v("android/app/build.gradle")]),a._v("，添加如下的签名配置：")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("\nandroid "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("\n    defaultConfig "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    signingConfigs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        release "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("project"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("hasProperty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'MYAPP_RELEASE_STORE_FILE'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                storeFile "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYAPP_RELEASE_STORE_FILE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                storePassword "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYAPP_RELEASE_STORE_PASSWORD")]),a._v("\n                keyAlias "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYAPP_RELEASE_KEY_ALIAS")]),a._v("\n                keyPassword "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYAPP_RELEASE_KEY_PASSWORD")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    buildTypes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        release "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("\n            signingConfig signingConfigs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("release "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 打release包，而不是debug")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("\n")])])]),t("h4",{attrs:{id:"针对不同的-cpu-架构生成-apk-以减小-apk-文件的大小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#针对不同的-cpu-架构生成-apk-以减小-apk-文件的大小"}},[a._v("#")]),a._v(" 针对不同的 CPU 架构生成 APK 以减小 APK 文件的大小")]),a._v(" "),t("ol",[t("li",[a._v("可以在 "),t("code",[a._v("android/app/build.gradle")]),a._v(" 中修改如下代码（false 改为 true）来生成多个针对不同 CPU 架构的 APK。")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// def enableSeparateBuildPerCPUArchitecture = false")]),a._v("\ndef enableSeparateBuildPerCPUArchitecture "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n")])])]),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// universalApk false")]),a._v("\nuniversalApk "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 额外生成一个适用不同CPU架构的通用APK")]),a._v("\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[t("code",[a._v("android/gradle.properties")]),a._v(" 打开第13行注释，用于 调整内存设置 不至于内存溢出。")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gradle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jvmargs"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Xmx2048m "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("XX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("MaxPermSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("512")]),a._v("m "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("XX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v("HeapDumpOnOutOfMemoryError "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Dfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("encoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("UTF")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n")])])]),t("h4",{attrs:{id:"生成发行-apk-包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成发行-apk-包"}},[a._v("#")]),a._v(" 生成发行 APK 包")]),a._v(" "),t("p",[a._v("终端执行以下命令")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("cd android "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 进入 android 目录")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("gradlew assembleRelease\n")])])]),t("blockquote",[t("p",[a._v("在 macOS、Linux 或是 windows 的 PowerShell 环境中表示执行当前目录下的名为 gradlew 的脚本文件，且其运行参数为 assembleRelease，注意这个./不可省略；而在 windows 的传统 CMD 命令行下则需要去掉 "),t("code",[a._v("./")]),a._v("。")])]),a._v(" "),t("p",[a._v("生成的 APK 文件位于"),t("code",[a._v("android/app/build/outputs/apk/release/app-release.apk")]),a._v("，它已经可以用来发布了。")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://reactnative.cn/docs/signed-apk-android",target:"_blank",rel:"noopener noreferrer"}},[a._v("官方原文"),t("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);